# Base Ubuntu 24.04 with systemd support
FROM jrei/systemd-ubuntu:24.04

# Disable frontend dialogs while installing packages
ENV DEBIAN_FRONTEND=non-interactive

# Install SSH server and sudo
RUN apt update \
    && apt install -y openssh-server sudo \
    && mkdir -p /var/run/sshd

# Set root password
RUN echo 'root:root' | chpasswd

# Add a new user 'admin' with sudo privileges
RUN useradd -rm -d /home/admin -s /bin/bash -g root -G sudo -u 1000 admin \
    && echo 'admin:admin' | chpasswd

# Create .ssh directory and authorized_keys file for root and admin
RUN mkdir -p /root/.ssh /home/admin/.ssh \
    && touch /root/.ssh/authorized_keys /home/admin/.ssh/authorized_keys \
    && chown -R admin:root /home/admin/.ssh

# Expose SSH port
EXPOSE 22

# Default command: start systemd (needed for ssh service inside container)
CMD ["/lib/systemd/systemd"]
